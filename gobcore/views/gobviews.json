{
  "meetbouten": {
    "meetbouten": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT  meetbouten.identificatie",
          "    ,       meetbouten.locatie",
          "    ,       eerste_metingen.datum                                           AS datum",
          "    ,       meest_recente_metingen.hoogte_tov_nap",
          "    ,       meest_recente_metingen.zakkingssnelheid",
          "    ,       meest_recente_metingen.zakking_cumulatief",
          "    ,       status",
          "    ,       meetbouten.geometrie",
          "    ,   json_build_object(",
          "             'identificatie', bouwblokken.identificatie,",
          "             'code', bouwblokken.code",
          "        ) AS _ref_ligt_in_bouwblok_gbd_bbk",
          "    ,   json_build_object(",
          "             'identificatie', buurten.identificatie,",
          "             'code', buurten.code,",
          "             'naam', buurten.naam",
          "        ) AS _ref_ligt_in_buurt_gbd_brt",
          "    ,   json_build_object(",
          "             'identificatie', stadsdelen.identificatie,",
          "             'code', stadsdelen.code,",
          "             'naam', stadsdelen.naam",
          "        ) AS _ref_ligt_in_stadsdeel_gdb_sdl",
          "    ,       nabij_nummeraanduiding AS _ref_nabij_nummeraanduiding_bag_nag",
          "            FROM              meetbouten_meetbouten                         AS meetbouten",
          "            LEFT JOIN (",
          "              SELECT identificatie, code FROM gebieden_bouwblokken",
          "              WHERE eind_geldigheid IS NULL) AS bouwblokken on meetbouten.ligt_in_bouwblok->>'_id' = bouwblokken.identificatie",
          "            LEFT JOIN (",
          "              SELECT identificatie, code, naam FROM gebieden_buurten",
          "              WHERE eind_geldigheid IS NULL) AS buurten on meetbouten.ligt_in_buurt->>'_id' = buurten.identificatie",
          "            LEFT JOIN (",
          "              SELECT identificatie, code, naam FROM gebieden_stadsdelen",
          "              WHERE eind_geldigheid IS NULL) AS stadsdelen on meetbouten.ligt_in_stadsdeel->>'_id' = stadsdelen.identificatie",
          "            LEFT JOIN (",
          "              SELECT DISTINCT ON (hoort_bij_meetbout->>'_id') * from meetbouten_metingen",
          "              ORDER BY hoort_bij_meetbout->>'_id', datum ASC",
          "            ) AS eerste_metingen ON meetbouten._id = eerste_metingen.hoort_bij_meetbout->>'_id'",
          "            LEFT JOIN (",
          "              SELECT DISTINCT ON (hoort_bij_meetbout->>'_id') * from meetbouten_metingen",
          "              ORDER BY hoort_bij_meetbout->>'_id', datum DESC",
          "            ) AS meest_recente_metingen ON meetbouten._id = meest_recente_metingen.hoort_bij_meetbout->>'_id'",
          "    WHERE meetbouten.publiceerbaar = TRUE"
        ]
      }
    },
    "metingen": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT metingen.identificatie",
          "    ,       datum",
          "    ,       type_meting",
          "    ,       hoogte_tov_nap",
          "    ,       zakking",
          "    ,       zakkingssnelheid",
          "    ,       zakking_cumulatief",
          "    ,       is_gemeten_door",
          "    ,       (hoeveelste_meting - 1)                                   AS hoeveelste_meting",
          "    ,       CASE WHEN aantal_dagen::TEXT = '0' THEN ''::TEXT",
          "                 ELSE aantal_dagen::TEXT",
          "            END                                                       AS aantal_dagen",
          "    ,       wijze_van_inwinnen",
          "    ,       hoort_bij_meetbout                                        AS _ref_hoort_bij_meetbout_mbn_mbt",
          "    ,       refereert_aan_referentiepunten                            AS _mref_refereert_aan_referentiepunten_mbn_rpt",
          "    ,   json_build_object(",
          "             'identificatie', stadsdelen.identificatie,",
          "             'code', stadsdelen.code,",
          "             'naam', stadsdelen.naam",
          "        ) AS _ref_ligt_in_stadsdeel_gbd_sdl",
          "    FROM  meetbouten_metingen                                         AS metingen",
          "    LEFT JOIN (",
          "            SELECT _id, ligt_in_stadsdeel->>'_id' AS ligt_in_stadsdeel FROM meetbouten_meetbouten",
          "    ) AS meetbouten ON metingen.hoort_bij_meetbout->>'_id' = meetbouten._id",
          "    LEFT JOIN (",
          "            SELECT identificatie, code, naam FROM gebieden_stadsdelen",
          "            WHERE eind_geldigheid IS NULL) AS stadsdelen on meetbouten.ligt_in_stadsdeel = stadsdelen.identificatie",
          "    WHERE metingen.publiceerbaar = TRUE"
        ]
      }
    },
    "referentiepunten": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT identificatie",
          "    ,      geometrie",
          "    ,      hoogte_tov_nap",
          "    ,      datum",
          "    ,      CONCAT_WS(' ', nabij_nummeraanduiding->>'bronwaarde', locatie)       AS locatie",
          "    FROM  meetbouten_referentiepunten",
          "    WHERE publiceerbaar = TRUE"
        ]
      }
    },
    "rollagen": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT meetbouten_rollagen.identificatie",
          "    ,       ROW_NUMBER() OVER (order by meetbouten_rollagen.identificatie) AS idx",
          "    ,       ST_centroid(bouwblokken.geometrie) AS geometrie",
          "    FROM  meetbouten_rollagen",
          "        LEFT JOIN",
          "            gebieden_bouwblokken AS bouwblokken",
          "            ON meetbouten_rollagen.identificatie = bouwblokken.code",
          "    ORDER BY meetbouten_rollagen.identificatie"
        ]
      }
    }
  },
  "nap": {
    "peilmerken": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT identificatie",
          "    ,      hoogte_tov_nap",
          "    ,      jaar",
          "    ,      merk",
          "    ,      omschrijving",
          "    ,      windrichting",
          "    ,      x_coordinaat_muurvlak",
          "    ,      y_coordinaat_muurvlak",
          "    ,      rws_nummer",
          "    ,      geometrie",
          "    FROM  nap_peilmerken",
          "    WHERE publiceerbaar = TRUE"
        ]
      }
    }
  },
  "gebieden": {
    "bouwblokken": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT",
          "        bouwblokken.identificatie",
          "    ,   bouwblokken.code",
          "    ,   bouwblokken.begin_geldigheid",
          "    ,   bouwblokken.eind_geldigheid",
          "    ,   json_build_object(",
          "             'identificatie', buurten.identificatie,",
          "             'code', buurten.code,",
          "             'naam', buurten.naam",
          "        ) AS _ref_ligt_in_buurt_gbd_brt",
          "    ,   json_build_object(",
          "             'identificatie', wijken.identificatie,",
          "             'code', wijken.code,",
          "             'naam', wijken.naam",
          "        ) AS _ref_ligt_in_wijk_gbd_wijk",
          "    ,   json_build_object(",
          "             'identificatie', ggwgebieden.identificatie,",
          "             'code', ggwgebieden.code,",
          "             'naam', ggwgebieden.naam",
          "        ) AS _ref_ligt_in_ggwgebied_gbd_ggw",
          "    ,   json_build_object(",
          "             'identificatie', ggpgebieden.identificatie,",
          "             'code', ggpgebieden.code,",
          "             'naam', ggpgebieden.naam",
          "        ) AS _ref_ligt_in_ggpgebied_gbd_ggp",
          "    ,   json_build_object(",
          "             'identificatie', stadsdelen.identificatie,",
          "             'code', stadsdelen.code,",
          "             'naam', stadsdelen.naam",
          "        ) AS _ref_ligt_in_stadsdeel_gbd_sdl",
          "    ,   json_build_object(",
          "             'identificatie', NULL,",
          "             'naam', NULL",
          "        ) AS _ref_ligt_in_gemeente_brk_gme",
          "    ,   bouwblokken.geometrie",
          "    FROM",
          "        gebieden_bouwblokken AS bouwblokken",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   eind_geldigheid",
          "            ,   ligt_in_wijk",
          "            FROM gebieden_buurten",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS buurten",
          "        ON bouwblokken.ligt_in_buurt->>'_id' = buurten.identificatie",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   eind_geldigheid",
          "            ,   ligt_in_stadsdeel",
          "            FROM gebieden_wijken",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS wijken",
          "            ON buurten.ligt_in_wijk->>'_id' = wijken.identificatie",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   value->>'_id' AS bestaat_uit_buurt",
          "            ,   eind_geldigheid",
          "            FROM gebieden_ggwgebieden, jsonb_array_elements(gebieden_ggwgebieden.bestaat_uit_buurten)",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS ggwgebieden",
          "            ON bouwblokken.ligt_in_buurt->>'_id' = ggwgebieden.bestaat_uit_buurt",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   value->>'_id' AS bestaat_uit_buurt",
          "            ,   eind_geldigheid",
          "            FROM gebieden_ggpgebieden, jsonb_array_elements(gebieden_ggpgebieden.bestaat_uit_buurten)",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS ggpgebieden",
          "            ON bouwblokken.ligt_in_buurt->>'_id' = ggpgebieden.bestaat_uit_buurt",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   eind_geldigheid",
          "            FROM gebieden_stadsdelen",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS stadsdelen",
          "            ON wijken.ligt_in_stadsdeel->>'_id' = stadsdelen.identificatie",
          "    WHERE bouwblokken.eind_geldigheid IS NULL"
        ]
      }
    },
    "buurten": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT",
          "        buurten.identificatie",
          "    ,   buurten.code",
          "    ,   buurten.naam",
          "    ,   buurten.begin_geldigheid",
          "    ,   buurten.eind_geldigheid",
          "    ,   buurten.documentdatum",
          "    ,   buurten.documentnummer",
          "    ,   buurten.cbs_code",
          "    ,   json_build_object(",
          "             'identificatie', wijken.identificatie,",
          "             'code', wijken.code,",
          "             'naam', wijken.naam",
          "        ) AS _ref_ligt_in_wijk_gbd_wijk",
          "    ,   json_build_object(",
          "             'identificatie', ggwgebieden.identificatie,",
          "             'code', ggwgebieden.code,",
          "             'naam', ggwgebieden.naam",
          "        ) AS _ref_ligt_in_ggwgebied_gbd_ggw",
          "    ,   json_build_object(",
          "             'identificatie', ggpgebieden.identificatie,",
          "             'code', ggpgebieden.code,",
          "             'naam', ggpgebieden.naam",
          "        ) AS _ref_ligt_in_ggpgebied_gebieden_ggpgebieden",
          "    ,   json_build_object(",
          "             'identificatie', stadsdelen.identificatie,",
          "             'code', stadsdelen.code,",
          "             'naam', stadsdelen.naam",
          "        ) AS _ref_ligt_in_stadsdeel_gbd_sdl",
          "    ,   json_build_object(",
          "             'identificatie', NULL,",
          "             'naam', NULL",
          "        ) AS _ref_ligt_in_gemeente_brk_gme",
          "    ,   buurten.geometrie",
          "    FROM",
          "        gebieden_buurten AS buurten",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   eind_geldigheid",
          "            ,   ligt_in_stadsdeel",
          "            FROM gebieden_wijken",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS wijken",
          "            ON buurten.ligt_in_wijk->>'_id' = wijken.identificatie",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   value->>'_id' AS bestaat_uit_buurt",
          "            ,   eind_geldigheid",
          "            FROM gebieden_ggwgebieden, jsonb_array_elements(gebieden_ggwgebieden.bestaat_uit_buurten)",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS ggwgebieden",
          "            ON buurten.identificatie = ggwgebieden.bestaat_uit_buurt",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   value->>'_id' AS bestaat_uit_buurt",
          "            ,   eind_geldigheid",
          "            FROM gebieden_ggpgebieden, jsonb_array_elements(gebieden_ggpgebieden.bestaat_uit_buurten)",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS ggpgebieden",
          "            ON buurten.identificatie = ggpgebieden.bestaat_uit_buurt",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   eind_geldigheid",
          "            FROM gebieden_stadsdelen",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS stadsdelen",
          "            ON wijken.ligt_in_stadsdeel->>'_id' = stadsdelen.identificatie",
          "    WHERE buurten.eind_geldigheid IS NULL",
          "    ORDER BY buurten.code"
        ]
      }
    },
    "wijken": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT",
          "        wijken.identificatie",
          "    ,   wijken.code",
          "    ,   wijken.naam",
          "    ,   wijken.begin_geldigheid",
          "    ,   wijken.eind_geldigheid",
          "    ,   wijken.documentdatum",
          "    ,   wijken.documentnummer",
          "    ,   wijken.cbs_code",
          "    ,   json_build_object(",
          "             'identificatie', ggwgebieden.identificatie,",
          "             'code', ggwgebieden.code,",
          "             'naam', ggwgebieden.naam",
          "        ) AS _ref_ligt_in_ggwgebied_gbd_ggw",
          "    ,   json_build_object(",
          "             'identificatie', stadsdelen.identificatie,",
          "             'code', stadsdelen.code,",
          "             'naam', stadsdelen.naam",
          "        ) AS _ref_ligt_in_stadsdeel_gbd_sdl",
          "    ,   json_build_object(",
          "             'identificatie', NULL,",
          "             'naam', NULL",
          "        ) AS _ref_ligt_in_gemeente_brk_gme",
          "    ,   wijken.geometrie",
          "    FROM",
          "        gebieden_wijken AS wijken",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   eind_geldigheid",
          "            ,   geometrie",
          "            FROM gebieden_ggwgebieden",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS ggwgebieden",
          "            ON ST_WITHIN(wijken.geometrie, ST_BUFFER(ggwgebieden.geometrie, 0.1))",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   eind_geldigheid",
          "            FROM gebieden_stadsdelen",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS stadsdelen",
          "            ON wijken.ligt_in_stadsdeel->>'_id' = stadsdelen.identificatie",
          "    WHERE wijken.eind_geldigheid IS NULL",
          "    ORDER BY wijken.code"
        ]
      }
    },
    "ggwgebieden": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT",
          "        ggwgebieden.identificatie",
          "    ,   ggwgebieden.code",
          "    ,   ggwgebieden.naam",
          "    ,   ggwgebieden.begin_geldigheid",
          "    ,   ggwgebieden.eind_geldigheid",
          "    ,   ggwgebieden.documentdatum",
          "    ,   ggwgebieden.documentnummer",
          "    ,   json_build_object(",
          "             'identificatie', stadsdelen.identificatie,",
          "             'code', stadsdelen.code,",
          "             'naam', stadsdelen.naam",
          "        ) AS _ref_ligt_in_stadsdeel_gbd_sdl",
          "    ,   json_build_object(",
          "             'identificatie', NULL,",
          "             'naam', NULL",
          "        ) AS _ref_ligt_in_gemeente_brk_gme",
          "    ,   ggwgebieden.geometrie",
          "    FROM",
          "        gebieden_ggwgebieden AS ggwgebieden",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   eind_geldigheid",
          "            FROM gebieden_stadsdelen",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS stadsdelen",
          "            ON ggwgebieden.ligt_in_stadsdeel->>'_id' = stadsdelen.identificatie",
          "    WHERE ggwgebieden.eind_geldigheid IS NULL",
          "    ORDER BY ggwgebieden.code"
        ]
      }
    },
    "ggpgebieden": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT",
          "        ggpgebieden.identificatie",
          "    ,   ggpgebieden.code",
          "    ,   ggpgebieden.naam",
          "    ,   ggpgebieden.begin_geldigheid",
          "    ,   ggpgebieden.eind_geldigheid",
          "    ,   ggpgebieden.documentdatum",
          "    ,   ggpgebieden.documentnummer",
          "    ,   json_build_object(",
          "             'identificatie', stadsdelen.identificatie,",
          "             'code', stadsdelen.code,",
          "             'naam', stadsdelen.naam",
          "        ) AS _ref_ligt_in_stadsdeel_gbd_sdl",
          "    ,   json_build_object(",
          "             'identificatie', NULL,",
          "             'naam', NULL",
          "        ) AS _ref_ligt_in_gemeente_brk_gme",
          "    ,   ggpgebieden.geometrie",
          "    FROM",
          "        gebieden_ggpgebieden AS ggpgebieden",
          "        LEFT JOIN",
          "            (SELECT",
          "                identificatie",
          "            ,   code",
          "            ,   naam",
          "            ,   eind_geldigheid",
          "            FROM gebieden_stadsdelen",
          "            WHERE eind_geldigheid IS NULL",
          "            ) AS stadsdelen",
          "            ON ggpgebieden.ligt_in_stadsdeel->>'_id' = stadsdelen.identificatie",
          "    WHERE ggpgebieden.eind_geldigheid IS NULL",
          "    ORDER BY ggpgebieden.code"
        ]
      }
    },
    "stadsdelen": {
      "enhanced": {
        "version": "0.1",
        "query": [
          "    SELECT",
          "        stadsdelen.identificatie",
          "    ,   stadsdelen.code",
          "    ,   stadsdelen.naam",
          "    ,   stadsdelen.begin_geldigheid",
          "    ,   stadsdelen.eind_geldigheid",
          "    ,   stadsdelen.documentdatum",
          "    ,   stadsdelen.documentnummer",
          "    ,   json_build_object(",
          "             'identificatie', NULL,",
          "             'naam', NULL",
          "        ) AS _ref_ligt_in_gemeente_brk_gme",
          "    ,   stadsdelen.geometrie",
          "    FROM",
          "        gebieden_stadsdelen AS stadsdelen",
          "    WHERE stadsdelen.eind_geldigheid IS NULL",
          "    ORDER BY stadsdelen.code"
        ]
      }
    }
  }
}
